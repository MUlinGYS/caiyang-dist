var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,i=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&o(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&o(e,a,t[a]);return e},n=(e,l)=>t(e,a(l)),u=(e,t,a)=>new Promise(((l,s)=>{var r=e=>{try{i(a.next(e))}catch(t){s(t)}},o=e=>{try{i(a.throw(e))}catch(t){s(t)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,o);i((a=a.apply(e,t)).next())}));import{c,a as d,m as p,A as m,k as v,_ as f}from"./index-rOxHBf93.js";/* empty css                  *//* empty css                    */import{_ as h}from"./Editor.vue_vue_type_style_index_0_lang-yw-5BgBF.js";/* empty css               */import{P as y,d as g,a9 as _,a3 as b,r as j,f as w,c as A,o as P,e as $,b as T,w as x,aO as E,C as O,m as V,u as k,as as C,F as U,A as q,L as M,at as S,aR as D,a0 as L,a_ as z,y as I,a$ as N,aq as R,$ as Y,M as J,x as B,I as F}from"./vendor-D3DmZvU-.js";import{a as G}from"./index-CyC1jm07.js";import{E as W}from"./emojo-Ben6gd8J.js";const H=G.create({timeout:15e3,baseURL:"http://localhost:3000",withCredentials:!0,transformRequest:[e=>JSON.stringify(e)],validateStatus:e=>e>=200&&e<300,headers:{get:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},post:{"Content-Type":"application/json;charset=utf-8"}},transformResponse:[(e,t)=>{const a=t["content-type"];if(a&&a.includes("application/json"))try{return JSON.parse(e)}catch(l){return e}return e}]});function K(e){return u(this,null,(function*(){var t,a;"POST"!==(null==(t=e.method)?void 0:t.toUpperCase())&&"PUT"!==(null==(a=e.method)?void 0:a.toUpperCase())||e.params&&!e.data&&(e.data=e.params,e.params=void 0);try{return(yield H.request(i({},e))).data}catch(l){return G.isAxiosError(l),Promise.reject(l)}}))}H.interceptors.request.use((e=>{const{accessToken:t}=c();return t&&e.headers.set({"Content-Type":"application/json",Authorization:t}),e}),(e=>(y.error(`服务器异常！ ${W[500]}`),Promise.reject(e)))),H.interceptors.response.use((e=>e),(e=>{var t;if(G.isCancel(e));else{const a=null==(t=e.response)?void 0:t.data.message;y.error(a?`${a} ${W[500]}`:`请求超时或服务器异常！${W[500]}`)}return Promise.reject(e)}));const Q={get:e=>K(n(i({},e),{method:"GET"})),post:e=>K(n(i({},e),{method:"POST"})),put:e=>K(n(i({},e),{method:"PUT"})),del:e=>K(n(i({},e),{method:"DELETE"}))};class X{static getArticleList(e){const{page:t,size:a,searchVal:l,year:s}=e;return Q.get({url:`/api/articles/${t}/${a}?title=${l}&year=${s}`})}static getArticleTypes(e){return Q.get({url:"/api/articles/types",params:e})}static getArticleDetail(e){return Q.get({url:`/api/articles/${e}`})}static addArticle(e){return Q.post({url:"/api/articles/",data:e})}static editArticle(e,t){return Q.put({url:`/api/articles/${e}`,data:t})}}var Z=(e=>(e[e.Add=0]="Add",e[e.Edit=1]="Edit",e))(Z||{});const ee={class:"article-edit"},te={class:"editor-wrap"},ae={class:"form-wrap"},le={class:"el-top upload-container"},se={key:0,class:"upload-placeholder"},re=["src"],oe={style:{display:"flex","justify-content":"flex-end"}},ie=f(g({__name:"ArticlePublish",setup(e){const t=_(),a=b(),l=c();let{accessToken:s}=l;const r={Authorization:s};let o=Z.Add;const i=j(""),n=j(),f=j(),g=j(""),H=j(""),K=j(""),Q=j(!0);w((()=>{d().scrollToTop(),ce(),ie()}));const ie=()=>{const{id:e}=t.query;o=e?Z.Edit:Z.Add,o===Z.Edit&&e?ne(Number(e)):ue()},ne=e=>{de=e,pe()},ue=()=>{H.value=ve(p().value)},ce=()=>u(this,null,(function*(){try{const e=yield G.get("https://www.qiniu.lingchen.kim/classify.json");e.data.code===m.success&&(f.value=e.data.data)}catch(e){}}));let de=0;const pe=()=>u(this,null,(function*(){const e=yield G.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.data.code===m.success){let{title:t,blog_class:a,html_content:l}=e.data.data;i.value=t,n.value=Number(a),g.value=l}})),me=()=>{o===Z.Edit?ge():ye()},ve=e=>v(e,"YYYY-MM-DD").value,fe=()=>i.value?n.value?"<p><br></p>"===g.value?(y.error("请输入文章内容"),!1):!!K.value||(y.error("请上传图片"),!1):(y.error("请选择文章类型"),!1):(y.error("请输入文章标题"),!1),he=()=>({title:i.value,html_content:g.value,home_img:K.value,blog_class:n.value,create_time:H.value}),ye=()=>u(this,null,(function*(){try{if(!fe())return;g.value=_e(g.value);const e=he();(yield X.addArticle(e)).code===m.success&&(y.success(`发布成功 ${W[200]}`),we())}catch(e){}})),ge=()=>u(this,null,(function*(){try{if(!fe())return;g.value=_e(g.value);const e=he();(yield X.editArticle(de,e)).code===m.success&&(y.success(`修改成功 ${W[200]}`),we())}catch(e){}})),_e=e=>e.replace(/(\s*)<\/code>/g,"</code>"),be=e=>{K.value=e.data.url,y.success(`图片上传成功 ${W[200]}`)},je=()=>{y.error(`图片上传失败 ${W[500]}`)},we=()=>{setTimeout((()=>{a.go(-1)}),800)},Ae=e=>{const t=e.type.startsWith("image/"),a=e.size/1024/1024<2;return t?!!a||(y.error("图片大小不能超过 2MB!"),!1):(y.error("只能上传图片文件!"),!1)};return(e,t)=>{const a=O,l=E,s=S,u=C,c=D,d=h,p=I,m=z,v=L,y=R,_=Y,b=F;return P(),A("div",ee,[$("div",null,[$("div",te,[T(c,{gutter:10},{default:x((()=>[T(l,{span:18},{default:x((()=>[T(a,{modelValue:k(i),"onUpdate:modelValue":t[0]||(t[0]=e=>V(i)?i.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),T(l,{span:6},{default:x((()=>[T(u,{modelValue:k(n),"onUpdate:modelValue":t[1]||(t[1]=e=>V(n)?n.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:x((()=>[(P(!0),A(U,null,q(k(f),(e=>(P(),M(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),T(d,{class:"el-top",modelValue:k(g),"onUpdate:modelValue":t[2]||(t[2]=e=>V(g)?g.value=e:null)},null,8,["modelValue"]),$("div",ae,[t[6]||(t[6]=$("h2",null,"发布设置",-1)),T(_,null,{default:x((()=>[T(v,{label:"封面"},{default:x((()=>[$("div",le,[T(m,{class:"cover-uploader",action:"http://localhost:3000/api/common/upload",headers:r,"show-file-list":!1,"on-success":be,"on-error":je,"before-upload":Ae},{default:x((()=>[k(K)?(P(),A("img",{key:1,src:k(K),class:"cover-image"},null,8,re)):(P(),A("div",se,[T(p,{class:"upload-icon"},{default:x((()=>[T(k(N))])),_:1}),t[4]||(t[4]=$("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1}),t[5]||(t[5]=$("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),T(v,{label:"可见"},{default:x((()=>[T(y,{modelValue:k(Q),"onUpdate:modelValue":t[3]||(t[3]=e=>V(Q)?Q.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1}),$("div",oe,[T(b,{type:"primary",onClick:me,style:{width:"100px"}},{default:x((()=>[J(B(k(o)===k(Z).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}),[["__scopeId","data-v-2f5cb9a1"]]);export{ie as default};
