var e=(e,a,l)=>new Promise(((t,s)=>{var r=e=>{try{u(l.next(e))}catch(a){s(a)}},o=e=>{try{u(l.throw(e))}catch(a){s(a)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);u((l=l.apply(e,a)).next())}));import{c as a,a as l,m as t,k as s,_ as r}from"./index.CeC0tU_n.js";/* empty css                  *//* empty css                    */import{_ as o}from"./Editor.vue_vue_type_style_index_0_lang.C0HmOse3.js";/* empty css               */import{d as u,a9 as i,a3 as c,r as d,f as n,c as p,o as m,e as v,b as f,w as _,aO as h,C as y,m as g,u as x,as as b,F as j,A,L as w,at as V,aR as $,a0 as k,a_ as E,y as q,a$ as M,aq as T,$ as z,M as P,x as U,I as Y,P as D}from"./vendor.FiRDnaVi.js";import{a as B}from"./index.sHp9jsdq.js";import{A as C}from"./status.CvEe1zvM.js";import{E as I}from"./emojo.Ben6gd8J.js";import{a as L}from"./index.CyC1jm07.js";class N{static getArticleList(e){const{page:a,size:l,searchVal:t,year:s}=e;return B.get({url:`/api/articles/${a}/${l}?title=${t}&year=${s}`})}static getArticleTypes(e){return B.get({url:"/api/articles/types",params:e})}static getArticleDetail(e){return B.get({url:`/api/articles/${e}`})}static addArticle(e){return B.post({url:"/api/articles/",data:e})}static editArticle(e,a){return B.put({url:`/api/articles/${e}`,data:a})}}var F=(e=>(e[e.Add=0]="Add",e[e.Edit=1]="Edit",e))(F||{});const G={class:"article-edit"},H={class:"editor-wrap"},O={class:"form-wrap"},R={class:"el-top upload-container"},W={key:0,class:"upload-placeholder"},J=["src"],K={style:{display:"flex","justify-content":"flex-end"}},Q=r(u({__name:"ArticlePublish",setup(r){const u=i(),B=c(),Q=a();let{accessToken:S}=Q;const X={Authorization:S};let Z=F.Add;const ee=d(""),ae=d(),le=d(),te=d(""),se=d(""),re=d(""),oe=d(!0);n((()=>{l().scrollToTop(),de(),ue()}));const ue=()=>{const{id:e}=u.query;Z=e?F.Edit:F.Add,Z===F.Edit&&e?ie(Number(e)):ce()},ie=e=>{ne=e,pe()},ce=()=>{se.value=ve(t().value)},de=()=>e(this,null,(function*(){try{const e=yield L.get("https://www.qiniu.lingchen.kim/classify.json");e.data.code===C.success&&(le.value=e.data.data)}catch(e){}}));let ne=0;const pe=()=>e(this,null,(function*(){const e=yield L.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.data.code===C.success){let{title:a,blog_class:l,html_content:t}=e.data.data;ee.value=a,ae.value=Number(l),te.value=t}})),me=()=>{Z===F.Edit?ye():he()},ve=e=>s(e,"YYYY-MM-DD").value,fe=()=>ee.value?ae.value?"<p><br></p>"===te.value?(D.error("请输入文章内容"),!1):!!re.value||(D.error("请上传图片"),!1):(D.error("请选择文章类型"),!1):(D.error("请输入文章标题"),!1),_e=()=>({title:ee.value,html_content:te.value,home_img:re.value,blog_class:ae.value,create_time:se.value}),he=()=>e(this,null,(function*(){try{if(!fe())return;te.value=ge(te.value);const e=_e();(yield N.addArticle(e)).code===C.success&&(D.success(`发布成功 ${I[200]}`),je())}catch(e){}})),ye=()=>e(this,null,(function*(){try{if(!fe())return;te.value=ge(te.value);const e=_e();(yield N.editArticle(ne,e)).code===C.success&&(D.success(`修改成功 ${I[200]}`),je())}catch(e){}})),ge=e=>e.replace(/(\s*)<\/code>/g,"</code>"),xe=e=>{re.value=e.data.url,D.success(`图片上传成功 ${I[200]}`)},be=()=>{D.error(`图片上传失败 ${I[500]}`)},je=()=>{setTimeout((()=>{B.go(-1)}),800)},Ae=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<2;return a?!!l||(D.error("图片大小不能超过 2MB!"),!1):(D.error("只能上传图片文件!"),!1)};return(e,a)=>{const l=y,t=h,s=V,r=b,u=$,i=o,c=q,d=E,n=k,D=T,B=z,C=Y;return m(),p("div",G,[v("div",null,[v("div",H,[f(u,{gutter:10},{default:_((()=>[f(t,{span:18},{default:_((()=>[f(l,{modelValue:x(ee),"onUpdate:modelValue":a[0]||(a[0]=e=>g(ee)?ee.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),f(t,{span:6},{default:_((()=>[f(r,{modelValue:x(ae),"onUpdate:modelValue":a[1]||(a[1]=e=>g(ae)?ae.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:_((()=>[(m(!0),p(j,null,A(x(le),(e=>(m(),w(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),f(i,{class:"el-top",modelValue:x(te),"onUpdate:modelValue":a[2]||(a[2]=e=>g(te)?te.value=e:null)},null,8,["modelValue"]),v("div",O,[a[6]||(a[6]=v("h2",null,"发布设置",-1)),f(B,null,{default:_((()=>[f(n,{label:"封面"},{default:_((()=>[v("div",R,[f(d,{class:"cover-uploader",action:"https://xxxx.com/api/common/upload",headers:X,"show-file-list":!1,"on-success":xe,"on-error":be,"before-upload":Ae},{default:_((()=>[x(re)?(m(),p("img",{key:1,src:x(re),class:"cover-image"},null,8,J)):(m(),p("div",W,[f(c,{class:"upload-icon"},{default:_((()=>[f(x(M))])),_:1}),a[4]||(a[4]=v("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1}),a[5]||(a[5]=v("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),f(n,{label:"可见"},{default:_((()=>[f(D,{modelValue:x(oe),"onUpdate:modelValue":a[3]||(a[3]=e=>g(oe)?oe.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1}),v("div",K,[f(C,{type:"primary",onClick:me,style:{width:"100px"}},{default:_((()=>[P(U(x(Z)===x(F).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}),[["__scopeId","data-v-2f5cb9a1"]]);export{Q as default};
