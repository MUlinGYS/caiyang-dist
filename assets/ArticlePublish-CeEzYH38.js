var e=(e,a,l)=>new Promise(((t,s)=>{var r=e=>{try{o(l.next(e))}catch(a){s(a)}},u=e=>{try{o(l.throw(e))}catch(a){s(a)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,u);o((l=l.apply(e,a)).next())}));import{n as a,c as l,a as t,o as s,k as r,A as u,m as o,E as i,_ as c}from"./index-CiSzWpKk.js";/* empty css                  *//* empty css                    */import{_ as d}from"./Editor.vue_vue_type_style_index_0_lang-R5I8Q_A3.js";/* empty css               */import{d as n,a9 as p,a3 as m,r as v,f,c as h,o as _,e as y,b as g,w as b,aO as A,C as w,m as V,u as $,as as x,F as j,A as k,L as E,at as M,aR as T,a0 as q,a_ as P,y as U,a$ as Y,aq as z,$ as D,M as C,x as I,I as L,P as N}from"./vendor-D3DmZvU-.js";class B{static getArticleList(e){const{page:l,size:t,searchVal:s,year:r}=e;return a.get({url:`/api/articles/${l}/${t}?title=${s}&year=${r}`})}static getArticleTypes(e){return a.get({url:"/api/articles/types",params:e})}static getArticleDetail(e){return a.get({url:`/api/articles/${e}`})}static addArticle(e){return a.post({url:"/api/articles/",data:e})}static editArticle(e,l){return a.put({url:`/api/articles/${e}`,data:l})}}var F=(e=>(e[e.Add=0]="Add",e[e.Edit=1]="Edit",e))(F||{});const J={class:"article-edit"},K={class:"editor-wrap"},O={class:"form-wrap"},R={class:"el-top upload-container"},W={key:0,class:"upload-placeholder"},G=["src"],H={style:{display:"flex","justify-content":"flex-end"}},Q=c(n({__name:"ArticlePublish",setup(a){const c=p(),n=m(),Q=l();let{accessToken:S}=Q;const X={Authorization:S};let Z=F.Add;const ee=v(""),ae=v(),le=v(),te=v(""),se=v(""),re=v(""),ue=v(!0);f((()=>{t().scrollToTop(),de(),oe()}));const oe=()=>{const{id:e}=c.query;Z=e?F.Edit:F.Add,Z===F.Edit&&e?ie(Number(e)):ce()},ie=e=>{ne=e,pe()},ce=()=>{se.value=ve(s().value)},de=()=>e(this,null,(function*(){try{const e=yield r.get("https://www.qiniu.lingchen.kim/classify.json");e.data.code===u.success&&(le.value=e.data.data)}catch(e){}}));let ne=0;const pe=()=>e(this,null,(function*(){const e=yield r.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.data.code===u.success){let{title:a,blog_class:l,html_content:t}=e.data.data;ee.value=a,ae.value=Number(l),te.value=t}})),me=()=>{Z===F.Edit?ye():_e()},ve=e=>o(e,"YYYY-MM-DD").value,fe=()=>ee.value?ae.value?"<p><br></p>"===te.value?(N.error("请输入文章内容"),!1):!!re.value||(N.error("请上传图片"),!1):(N.error("请选择文章类型"),!1):(N.error("请输入文章标题"),!1),he=()=>({title:ee.value,html_content:te.value,home_img:re.value,blog_class:ae.value,create_time:se.value}),_e=()=>e(this,null,(function*(){try{if(!fe())return;te.value=ge(te.value);const e=he();(yield B.addArticle(e)).code===u.success&&(N.success(`发布成功 ${i[200]}`),we())}catch(e){}})),ye=()=>e(this,null,(function*(){try{if(!fe())return;te.value=ge(te.value);const e=he();(yield B.editArticle(ne,e)).code===u.success&&(N.success(`修改成功 ${i[200]}`),we())}catch(e){}})),ge=e=>e.replace(/(\s*)<\/code>/g,"</code>"),be=e=>{re.value=e.data.url,N.success(`图片上传成功 ${i[200]}`)},Ae=()=>{N.error(`图片上传失败 ${i[500]}`)},we=()=>{setTimeout((()=>{n.go(-1)}),800)},Ve=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<2;return a?!!l||(N.error("图片大小不能超过 2MB!"),!1):(N.error("只能上传图片文件!"),!1)};return(e,a)=>{const l=w,t=A,s=M,r=x,u=T,o=d,i=U,c=P,n=q,p=z,m=D,v=L;return _(),h("div",J,[y("div",null,[y("div",K,[g(u,{gutter:10},{default:b((()=>[g(t,{span:18},{default:b((()=>[g(l,{modelValue:$(ee),"onUpdate:modelValue":a[0]||(a[0]=e=>V(ee)?ee.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),g(t,{span:6},{default:b((()=>[g(r,{modelValue:$(ae),"onUpdate:modelValue":a[1]||(a[1]=e=>V(ae)?ae.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:b((()=>[(_(!0),h(j,null,k($(le),(e=>(_(),E(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),g(o,{class:"el-top",modelValue:$(te),"onUpdate:modelValue":a[2]||(a[2]=e=>V(te)?te.value=e:null)},null,8,["modelValue"]),y("div",O,[a[6]||(a[6]=y("h2",null,"发布设置",-1)),g(m,null,{default:b((()=>[g(n,{label:"封面"},{default:b((()=>[y("div",R,[g(c,{class:"cover-uploader",action:"http://localhost:3000/api/common/upload",headers:X,"show-file-list":!1,"on-success":be,"on-error":Ae,"before-upload":Ve},{default:b((()=>[$(re)?(_(),h("img",{key:1,src:$(re),class:"cover-image"},null,8,G)):(_(),h("div",W,[g(i,{class:"upload-icon"},{default:b((()=>[g($(Y))])),_:1}),a[4]||(a[4]=y("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1}),a[5]||(a[5]=y("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),g(n,{label:"可见"},{default:b((()=>[g(p,{modelValue:$(ue),"onUpdate:modelValue":a[3]||(a[3]=e=>V(ue)?ue.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1}),y("div",H,[g(v,{type:"primary",onClick:me,style:{width:"100px"}},{default:b((()=>[C(I($(Z)===$(F).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}),[["__scopeId","data-v-2f5cb9a1"]]);export{Q as default};
