var e=(e,a,t)=>new Promise(((l,i)=>{var d=e=>{try{n(t.next(e))}catch(a){i(a)}},o=e=>{try{n(t.throw(e))}catch(a){i(a)}},n=e=>e.done?l(e.value):Promise.resolve(e.value).then(d,o);n((t=t.apply(e,a)).next())}));import{u as a,_ as t}from"./index.CeC0tU_n.js";import{D as l}from"./deviceApi.DnKNhgy4.js";/* empty css                   */import{d as i,j as d,p as o,f as n,s as v,r as s,c as u,b as r,e as m,_ as p,w as c,b2 as f,I as y,P as h,aK as g,aI as x,M as w,C as b,aL as k,y as C,z as S,x as _,o as z}from"./vendor.FiRDnaVi.js";import"./index.sHp9jsdq.js";import"./index.CyC1jm07.js";import"./emojo.Ben6gd8J.js";const I={class:"region active-user art-custom-card"},j={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},V={class:"box"},B={style:{height:"10%","max-height":"10%",width:"calc(100% + 1px)",display:"flex","background-color":"var(--main-color)","align-items":"center","justify-content":"space-between"}},E={style:{display:"flex",height:"100%",width:"auto","align-items":"center"}},q={style:{display:"flex",height:"100%",width:"auto","align-items":"center"}},T=t(i({__name:"ActiveUser",setup(t){const i=a(),T=d((()=>i.menuOpen));o(T,(()=>{})),n((()=>{})),v((()=>{}));const L=()=>e(this,null,(function*(){var e,a,t,l,i,d,o,n,v,s,u,r,m,p,c,f,y,g,x,w,b;if(!N.value)return void h({message:"请选择启动的设备",type:"warning"});const k={method:"setGpio",params:{aerosolFlow:null==(e=document.getElementById("aerosol-flow"))?void 0:e.value,aerosolTime:null==(a=document.getElementById("aerosol-time"))?void 0:a.value,aerosolVolume:null==(t=document.getElementById("aerosol-volume"))?void 0:t.value,aerosolChannel:null==(l=document.getElementById("aerosol-channel"))?void 0:l.value,diaphragm1Flow:null==(i=document.getElementById("diaphragm1-flow"))?void 0:i.value,diaphragm1Time:null==(d=document.getElementById("diaphragm1-time"))?void 0:d.value,diaphragm1Volume:null==(o=document.getElementById("diaphragm1-volume"))?void 0:o.value,diaphragm1Channel:null==(n=document.getElementById("diaphragm1-channel"))?void 0:n.value,diaphragm2Flow:null==(v=document.getElementById("diaphragm2-flow"))?void 0:v.value,diaphragm2Time:null==(s=document.getElementById("diaphragm2-time"))?void 0:s.value,diaphragm2Volume:null==(u=document.getElementById("diaphragm2-volume"))?void 0:u.value,diaphragm2Channel:null==(r=document.getElementById("diaphragm2-channel"))?void 0:r.value,sample1:null==(m=document.querySelector('input[name="sample1"]'))?void 0:m.value,sample2:null==(p=document.querySelector('input[name="sample2"]'))?void 0:p.value,sample3:null==(c=document.querySelector('input[name="sample3"]'))?void 0:c.value,matrix1:null==(f=document.querySelector('select[name="matrix1"]'))?void 0:f.value,matrix2:null==(y=document.querySelector('select[name="matrix2"]'))?void 0:y.value,matrix3:null==(g=document.querySelector('select[name="matrix3"]'))?void 0:g.value,type1:null==(x=document.querySelector('select[name="type1"]'))?void 0:x.value,type2:null==(w=document.querySelector('select[name="type2"]'))?void 0:w.value,type3:null==(b=document.querySelector('select[name="type3"]'))?void 0:b.value},persistent:!1,timeout:5e3},C=sessionStorage.getItem("accessToken");if(C)try{const e=yield fetch(`http://60.204.231.249:8080/api/rpc/oneway/${N.value}`,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json","X-Authorization":`Bearer ${C}`},body:JSON.stringify(k)});e.ok?200===e.status&&(h({message:"下发成功",type:"success"}),le(),A.value=!0):504===e.status&&h({message:"请检查设备状态",type:"warning"});yield e.json()}catch(S){}})),U=s(!1),A=s(!1),O=()=>{U.value=!0,te()},P=()=>{N.value?(A.value=!0,le()):h({message:"请选择启动的设备",type:"warning"})},D=s(""),F=d((()=>K.value.filter((e=>!D.value||e.name.toLowerCase().includes(D.value.toLowerCase()))))),$=s(""),J=d((()=>R.value.filter((e=>!$.value||e.name.toLowerCase().includes($.value.toLowerCase()))))),N=s(""),M=s("选择设备"),G=s(""),K=s([{date:"加载中",name:"加载中",state:"加载中",id:"",type:""}]),R=s([{time:"加载中",name:"加载中",value:"加载中"}]),X=s(1),H=s(20),Q=s("default"),W=s(!1),Y=s(!1),Z=e=>{H.value=e,te()},ee=e=>{X.value=e,te()},ae=s(0),te=()=>e(this,null,(function*(){try{const e=yield l.Device({body:JSON.stringify({}),pageSize:H.value,page:X.value-1});if(e){const a=e.data.map((e=>({date:new Date(e.createdTime).toLocaleString(),name:e.name||"未命名设备",state:e.active?"活动中":"离线",id:e.id.id,type:e.id.entityType})));K.value=a,ae.value=e.totalElements}}catch(e){}})),le=()=>e(this,null,(function*(){try{const e=yield l.Telemeteringapi({body:JSON.stringify({}),entityType:G.value,entityId:N.value,keys:""});if(e){const a=[];for(const[t,l]of Object.entries(e))if(Array.isArray(l))for(const e of l)a.push({time:new Date(e.ts).toLocaleString(),name:t,value:e.value});R.value=a}else h.error("获取遥测数据失败，请检查设备状态")}catch(e){h.error("网络请求失败，请重试")}}));return(e,a)=>{const t=x,l=b,i=y,d=g,o=k,n=p,v=S("DeleteFilled"),s=C,h=S("ArrowRight");return z(),u("div",I,[r(n,{modelValue:U.value,"onUpdate:modelValue":a[3]||(a[3]=e=>U.value=e),title:"设备选择",width:"720"},{default:c((()=>[r(d,{data:F.value,style:{width:"100%"},"max-height":"400",height:"400px"},{default:c((()=>[r(t,{fixed:"",prop:"date",label:"创建时间",width:"200"}),r(t,{prop:"name",label:"设备名称",width:"150"}),r(t,{prop:"state",label:"状态",width:"120"}),r(t,{align:"center"},{header:c((()=>[r(l,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e),size:"small",placeholder:"搜索设备名称"},null,8,["modelValue"])])),default:c((e=>[r(i,{size:"small",onClick:a=>{return e.$index,t=e.row,N.value=t.id,M.value=t.name,G.value=t.type,void(U.value=!1);var t}},{default:c((()=>a[6]||(a[6]=[w(" 选择 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),m("div",j,[r(o,{"pager-count":5,"current-page":X.value,"onUpdate:currentPage":a[1]||(a[1]=e=>X.value=e),"page-size":H.value,"onUpdate:pageSize":a[2]||(a[2]=e=>H.value=e),"page-sizes":[5,10,20,50],size:Q.value,disabled:Y.value,background:W.value,layout:"total, sizes, prev, pager, next, jumper",total:ae.value,onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","size","disabled","background","total"])])])),_:1},8,["modelValue"]),r(n,{modelValue:A.value,"onUpdate:modelValue":a[5]||(a[5]=e=>A.value=e),title:"遥测数据",width:"720"},{default:c((()=>[r(d,{data:J.value,style:{width:"100%"},"max-height":"400",height:"400px"},{default:c((()=>[r(t,{fixed:"",prop:"time",label:"最后更新时间",width:"200"}),r(t,{prop:"name",label:"键名",width:"170"}),r(t,{prop:"value",label:"数值",width:"150"}),r(t,{align:"center"},{header:c((()=>[r(l,{modelValue:$.value,"onUpdate:modelValue":a[4]||(a[4]=e=>$.value=e),size:"small",placeholder:"搜索键名"},null,8,["modelValue"])])),default:c((e=>[r(i,{size:"small",onClick:a=>(e.$index,e.row,void(A.value=!1))},{default:c((()=>[r(s,null,{default:c((()=>[r(v)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),m("div",V,[m("div",B,[m("div",E,[r(i,{type:"primary",size:"small",style:{"margin-left":"20px"},onClick:O},{default:c((()=>[w(_(M.value),1),r(s,{class:"el-icon--right"},{default:c((()=>[r(h)])),_:1})])),_:1})]),m("div",q,[r(i,{type:"primary",size:"small",style:{"margin-right":"20px"},onClick:P},{default:c((()=>[a[7]||(a[7]=w(" 遥测数据")),r(s,{class:"el-icon--right"},{default:c((()=>[r(h)])),_:1})])),_:1})])]),a[10]||(a[10]=f('<div class="table" data-v-72797f52><div class="row" data-v-72797f52><div class="item" data-v-72797f52>参数</div><div class="item" data-v-72797f52>目标流量(LPM)</div><div class="item" data-v-72797f52>采样时长(min)</div><div class="item" data-v-72797f52>累计体积(L)</div><div class="item" data-v-72797f52>通道启用</div></div><div class="row" data-v-72797f52><div class="item" data-v-72797f52><a style="overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;" data-v-72797f52>气溶胶泵流量</a></div><div class="item" data-v-72797f52><input type="text" id="aerosol-flow" placeholder="目标流量" data-v-72797f52></div><div class="item" data-v-72797f52><input type="text" id="aerosol-time" placeholder="采样时长" data-v-72797f52></div><div class="item" data-v-72797f52><input type="text" id="aerosol-volume" placeholder="累计体积" data-v-72797f52></div><div class="item" data-v-72797f52><input type="text" id="aerosol-channel" placeholder="通道状态" data-v-72797f52></div></div><div class="row" data-v-72797f52><div class="item" data-v-72797f52><a style="overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;" data-v-72797f52>隔膜泵1流量</a></div><div class="item" data-v-72797f52><input type="text" id="diaphragm1-flow" value="" data-v-72797f52></div><div class="item" data-v-72797f52><input type="text" id="diaphragm1-time" value="" data-v-72797f52></div><div class="item" data-v-72797f52><input type="text" id="diaphragm1-volume" value="" data-v-72797f52></div><div class="item" data-v-72797f52><input type="text" id="diaphragm1-channel" value="" data-v-72797f52></div></div><div class="row" data-v-72797f52><div class="item" data-v-72797f52><a style="overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;" data-v-72797f52>隔膜泵2流量</a></div><div class="item" data-v-72797f52><input type="text" id="diaphragm2-flow" value="" data-v-72797f52></div><div class="item" data-v-72797f52><input type="text" id="diaphragm2-time" value="" data-v-72797f52></div><div class="item" data-v-72797f52><input type="text" id="diaphragm2-volume" value="" data-v-72797f52></div><div class="item" data-v-72797f52><input type="text" id="diaphragm2-channel" value="" data-v-72797f52></div></div></div>',1)),m("div",{class:"table2"},[a[9]||(a[9]=f('<div class="item" data-v-72797f52>样品编号</div><div class="item2" data-v-72797f52><input type="text" name="sample1" placeholder="样品编号1" data-v-72797f52><input type="text" name="sample2" placeholder="样品编号2" data-v-72797f52><input type="text" name="sample3" placeholder="样品编号3" data-v-72797f52></div><div class="item2" data-v-72797f52><select name="matrix1" aria-label="空铀氟" data-v-72797f52><option value="空铀" data-v-72797f52>空铀</option><option value="空氟" data-v-72797f52>空氟</option></select><select name="matrix2" aria-label="空铀氟" data-v-72797f52><option value="空氟" data-v-72797f52>空氟</option><option value="空铀" data-v-72797f52>空铀</option></select><select name="matrix3" aria-label="空铀氟" data-v-72797f52><option value="空铀" data-v-72797f52>空铀</option><option value="空氟" data-v-72797f52>空氟</option></select></div><div class="item2" data-v-72797f52><select name="type1" aria-label="年样" data-v-72797f52><option value="年样" data-v-72797f52>年样</option><option value="半年样" data-v-72797f52>半年样</option></select><select name="type2" aria-label="年样" data-v-72797f52><option value="半年样" data-v-72797f52>半年样</option><option value="年样" data-v-72797f52>年样</option></select><select name="type3" aria-label="年样" data-v-72797f52><option value="半年样" data-v-72797f52>半年样</option><option value="年样" data-v-72797f52>年样</option></select></div>',4)),m("div",{style:{width:"65px"}},[a[8]||(a[8]=m("p",null,"设备启动",-1)),m("button",{id:"startButton",type:"button",class:"divbutton",style:{"margin-top":"10px"},onClick:L},"启动")])])])])}}}),[["__scopeId","data-v-72797f52"]]);export{T as default};
